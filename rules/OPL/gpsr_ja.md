# General Purpose Service Robot (GPSR)

[**日本語**](./gpsr_ja.md) | [English](./gpsr_en.md)

参考動画：https://youtu.be/p9ki89buY68 <br>
> **Note**
> この動画は参考動画である．RoboCupのルールによってタスク内容が異なる可能性がある．
> 質問や議論は，GitHubの[Issues](https://github.com/RoboCupAtHomeJP/Rule2023/issues)にて行う．

> **Note**
> このルールはRoboCup JapanOpen2022 OPLのGPSRに基づき作成されたものである．

## メインゴール

このタスクでは，ロボットがユーザからの様々な要求に対して応じる汎用サービスを想定する．この競技では，予め決められたタスクの流れや命令，行動内容などは存在しない．競技内でユーザが要求するタスクは，大量に用意したタスク内容の中から審査員によってランダムに選択される．これらの要求は，複雑さに応じて3つのカテゴリに分類され，このカテゴリの難易度に基づいて得点も変化する．

## フォーカス

複雑な音声対話，予め定義されていない命令の実行，効率的かつスピーディなタスクの実行，既知環境でのマッピングやナビゲーション，タスクプランニング

## セットアップ

- **ロケーション**: 家庭環境を模したアリーナ環境が用いられる．特に競技はリビングルームで行われます．アリーナ内は事前にマッピングすることができる（既知の環境）．
- **スタートロケーション**: ロボットは，アリーナの外からスタートする．
- **オペレーター**: オペレーターは，ランダムに選択されたタスクを，ロボットに実行するよう命令する．オペレーターは各チームから選出する．
- **ゲスト**: ゲストは，選択されたタスクに応じて，ジェスチャーやロボットとのインタラクションを行う．ゲストの人数は最大で3人である．ゲストは各チームから選出することができる．

## シナリオ

### a. スタートフェーズ

1. **競技時間**: 競技時間は10分間である．
2. **配置**: レフェリーは，チームにロボットをスタート位置へ移動させるよう指示する．
3. **スタート**: レフェリーはスタートの合図を出し，タイマーをスタートさせる．同時にチームは最後の簡単なセットアップ(スタートボタンを押す等)を完了し，エリアを離れる．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められない．
4. **ドアオープン**: チームの1人はスタートの合図と同時にドアを開ける．ロボットはドアが開いたことを認識し，自律的にアリーナへ入場する．
5. **ゴール**: 1つの命令タスクに対して，コマンドフェーズとサービスフェーズを行う．これを3回繰り返す．

### b. コマンドフェーズ

1. **タスクの選択**: チームがレフェリーに希望するカテゴリを伝え，ランダムにカテゴリ内のタスクを選択する．選択したカテゴリに応じてレフェリーはタスクの命令をオペレーターに伝える．
   - Category 1: 低難易度命令
   - Category 2: 中難易度命令
   - Category 3: 高難易度命令 or 不足情報/誤情報を含む命令
2. **ロボットへの命令**: オペレータは，選択されたタスクをロボットに命令する．ロボットがオペレータの命令について理解できなかった場合，もう一度発言を繰り返すように要求することができる．もし，受け取った命令で不足する情報があればロボットから人間に聞くことができる．

### c. サービスフェーズ

1. 命令の復唱: ロボットは命令受け取ったあと，命令内容を復唱してから行動を開始する．
2. サービス: ロボットは，与えられた命令のタスクを実行する．タスクの終了後は，次の命令のためにオペレータのもとへ戻る．再度ドアオープンしてアリーナに入る必要はない．

## 注意事項

### スキップの禁止

タスクは3ステップで構成され，ステップごとに配点が高くなる．現在与えられている（少なくともフェーズ1の）命令を達成しなければ次のステップへ進むことはできない．

### コマンドジェネレータの事前公開

カテゴリ1から3の命令は[コマンドジェネレータ](https://github.com/kyordhel/GPSRCmdGen/tree/legacy)を使用して生成する．TCは事前に命令を十分な数生成し，必要に応じてテスト環境に合わせて命令の変数を変更する．タスクで用いられる命令は，この中からランダムに選定される．

## デウスエクスマキナ

本タスクでは，次のデウスエクスマキナが採用される．デウスエクスマキナを使用すると，該当アクションの点数は入らないが，より簡単な手法でアクションをスキップし，タスクを継続することができる．

| Action  | Bypassing |
|------- | -- |
| 音声対話 | &bullet; マーカを用いてオペレータとのコミュニケーションを図る |
| タスクの支援 | &bullet; ロボットがタスクを行うのを何かしらの方法で支援する事もできる（その場合，審査員基準で50～200pts減点される） |
| コマンドセットの使用 | &bullet; Command Category 1の命令文をコマンドジェネレータで生成する代わりに，コマンドセットを使用する（命令理解の得点が減点され，命令理解後のタスク遂行に関するスコアは$cat. 1$と同じとする）． |

### コマンドセット

| タスクの種類 | 命令文例 |
| --- | --- |
| **Carrying** | &bullet; Go to the ` $ROOM`, grasp the `$OBJECT` on the `$PLACE` and place it on the `$PLACE`. <br>&bullet; Go to the `$ROOM`, grasp the `$OBJECT` on the `$PLACE` and give it to `$PERSON`. |
| **Vision** <br>find (obj \| people) | &bullet; Tell me how many `$CATEGORY_OBJ` there are on the `$PLACE`. <br>&bullet; Tell me how many people in the `$ROOM` are `$POSTURE`. |
| **Navigation** <br>follow, guide | &bullet; Go to the `$ROOM`, find `$PERSON` at the `$ROOM` and follow (him \| her). <br>&bullet; Go to the `$ROOM`, find `$PERSON` at the `$ROOM` and guide `(him\|her)` to the `$ROOM`. |
| **Speech** <br>question, answer | &bullet; Go to the `$ROOM`, find `$PERSON` at the `$ROOM` and answer (his \| her) question. <br>&bullet; Go to the `$ROOM`, find `$PERSON` at the `$ROOM` and ask (him \| her) `$QUESTION`. |

## スコアシート

各動作を4つのパートに分け，1パートずつ部分点を設定する．カテゴリ難易度に応じて$cat$の変数が変化する（以下表を参照）．

| Action | Score |
| -- | -- |
|**メインタスク** |  |
| 命令を理解できた | $3 \times 20$ |
| 1回目の命令タスクを実行 | $(5 \times 4) \times cat$ |
| 2回目の命令タスクを実行 | $(10 \times 4) \times cat$ |
| 3回目の命令タスクを実行 | $(20 \times 4) \times cat$ |
| 全てのコマンドを実行した後アリーナから退出する | $20$ |
| **ペナルティ** |  |
| 不参加（無断） | $-500$ |
| 合計 | $500$ |

### 各タスクにおける部分点の内訳

| タスクの種類 | フェーズ1 | フェーズ2 | フェーズ3 | フェーズ4 |
| --- | --- | --- | --- | --- |
| Carrying | 物体の前まで移動する | 物体を把持する | 配置場所 / 人の前まで移動する | 物体を配置する / 渡す |
| Vision | 観測する部屋・場所まで移動する | 対象を観測する | オペレーターの前まで移動する | 観測結果を報告する |
| Navigation | 人の前まで移動する | 人を追従 / 誘導する | 追従 / 誘導先まで移動する | 追従終了を認識 / 誘導終了を報告する |
| Speech(ask) | 人の前まで移動する | 人に質問する | オペレーターの前まで移動する | 質問の答えを報告する |
| Speech(answer) | 人の前まで移動する | 人に質問を要求する | 質問に答える | オペレーターの前まで移動する |

### カテゴリごとの加重

| Category | $cat.$ |
| -------- | ------ |
| 0 | 1 |
| 1 | 1 |
| 2 | 2 |
| 3 | 3 |

## 運営(TC)による指示

- 準備
  - ボランティア2名に名前を割り当てる．
  - オペレータに挑戦するコマンドを伝える．
- アナウンス(Setup day)
  - 部屋，ロケーション，人物の名称を公開する．
  - 物体の置かれる可能性がある場所を公開する．
  - オペレータ（人物）から命令を聞く可能性のある場所を公開する．
  - アリーナの入口と出口のドアの場所を公開する．

## レフェリーの動き

レフェリーは各チームから数名選出され，他チームの競技において以下を行う．

- 競技開始30分前に集まり，説明を受けスコアシートとコマンドリストを受け取る．
- シナリオに記載のレフェリーとして行動する．
- 競技を採点する
- 他のTCと採点内容を確認する．
- スコアシートを提出する．
